<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Reviews - SunnySide Market</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    body { background-color: #FFFBEA; font-family: Arial, sans-serif; }
    nav.navbar { background-color: #2E8B57 !important; }
    nav .navbar-brand { font-family: 'Pacifico', cursive; font-size: 1.8rem; color: white !important; }
    nav .nav-link { color: white !important; font-weight: bold; }
    nav .nav-link:hover { background-color: #FFD54F; color: black !important; border-radius: 5px; }
    .reviews-container { max-width: 900px; margin: 30px auto; }
    .review-card { background-color: #FFF5E1; padding: 20px; margin-bottom: 15px; border-radius: 10px; }
    .review-card h5 { color: #2E8B57; margin-bottom: 5px; }
    .review-card .rating { color: #FFA500; font-weight: bold; }
    .btn-delete { background-color: transparent; border: none; color: #FF8C00; font-size: 1rem; }
    .btn-delete:hover { color: #FFA500; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-sm navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">SunnySide Market</a>
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/shopping">Shopping</a></li>
          <li class="nav-item"><a class="nav-link" href="/cart">Cart</a></li>
          <li class="nav-item"><a class="nav-link" href="/reviews">Reviews</a></li>
          <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container reviews-container">
    <h2>Product Reviews</h2>
    <% if (!reviews || reviews.length === 0) { %>
      <p>No reviews yet. Be the first to review a product!</p>
    <% } else { %>
      <% reviews.forEach(review => { %>
        <div class="review-card">
          <h5><%= review.username %> on <strong><%= review.productName %></strong></h5>
          <p class="rating">Rating: <%= review.rating %> / 5</p>
          <p><%= review.comment %></p>
          <% if (user.role === 'admin') { %>
            <form action="/reviews/delete/<%= review.id %>" method="POST" style="display:inline-block;">
              <button class="btn-delete">Delete</button>
            </form>
          <% } %>
          <small class="text-muted">Posted on <%= new Date(review.createdAt).toLocaleString() %></small>
        </div>
      <% }) %>
    <% } %>

    <% if (user.role !== 'admin') { %>
      <h4 class="mt-4">Leave a Review</h4>
      <form action="/reviews/add" method="POST">
        <div class="mb-2">
          <label class="form-label">Product</label>
          <select class="form-select" name="productId" required>
            <% products.forEach(p => { %>
              <option value="<%= p.id %>"><%= p.productName %></option>
            <% }) %>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Rating</label>
          <select class="form-select" name="rating" required>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Comment</label>
          <textarea class="form-control" name="comment" rows="3" maxlength="500"></textarea>
        </div>
        <button type="submit" class="btn btn-orange">Submit Review</button>
      </form>
    <% } %>
  </div>
</body>
</html>

